:root{
  /* ライトモードカラー */
  --primary-50: #E3F2FD;
  --primary-100: #BBDEFB;
  --primary-400: #42A5F5;
  --primary-500: #2196F3;
  --primary-600: #1E88E5;
  --primary-700: #1976D2;

  --secondary-400: #26A69A;
  --secondary-500: #009688;
  --secondary-600: #00897B;

  --success-50: #E8F5E9;
  --success-500: #4CAF50;
  --success-700: #388E3C;

  --error-50: #FFEBEE;
  --error-500: #EF5350;
  --error-700: #D32F2F;

  --warning-50: #FFF3E0;
  --warning-500: #FFC107;
  --warning-700: #FFA000;

  --gray-50: #FAFAFA;
  --gray-100: #F5F5F5;
  --gray-200: #EEEEEE;
  --gray-400: #BDBDBD;
  --gray-600: #757575;
  --gray-800: #424242;
  --gray-900: #212121;

  /* ダークモードカラー */
  --primary-dark-400: #64B5F6;
  --primary-dark-500: #42A5F5;
  --primary-dark-600: #2196F3;

  --secondary-dark-400: #4DB6AC;
  --secondary-dark-500: #26A69A;

  --success-dark-500: #66BB6A;
  --success-dark-700: #4CAF50;

  --error-dark-500: #EF5350;
  --error-dark-700: #E53935;

  --warning-dark-500: #FFCA28;
  --warning-dark-700: #FFC107;

  --gray-dark-800: #424242;
  --gray-dark-700: #616161;
  --gray-dark-600: #757575;
  --gray-dark-400: #BDBDBD;
  --gray-dark-200: #E0E0E0;

  /* デフォルト（ダークモード） */
  --bg:#08121f;
  --card:#0f1d35;
  --text:#eef2ff;
  --muted:#b9c4e6;
  --border:rgba(255,255,255,.1);
  --primary:#6aa6ff;
  --danger:#ff6a7a;
  --success:#4CAF50;
  --radius:16px;
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --font:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,Helvetica,Arial,sans-serif;

  /* アニメーション */
  --duration-fast: 150ms;
  --duration-base: 300ms;
  --duration-slow: 500ms;
  --duration-slower: 800ms;
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

/* ライトモード */
body.light-mode{
  --bg:#FFFFFF;
  --card:#F8F9FA;
  --text:#212121;
  --muted:#757575;
  --border:rgba(0,0,0,.08);
  --primary:#2196F3;
  --danger:#EF5350;
  --success:#4CAF50;
  --shadow:0 4px 12px rgba(0,0,0,.08);
  background: linear-gradient(180deg, #E3F2FD 0%, #FFFFFF 100%);
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:var(--font);
  color:var(--text);
  background: radial-gradient(1200px 700px at 20% 0%, #1b2a5a 0%, transparent 55%),
              radial-gradient(900px 600px at 90% 20%, #2a1b5a 0%, transparent 60%),
              var(--bg);
  transition: background var(--duration-base) var(--ease-in-out), color var(--duration-base) var(--ease-in-out);
}
body.light-mode{
  background: linear-gradient(180deg, #E3F2FD 0%, #FFFFFF 100%);
}
.container{max-width:1050px;margin:0 auto;padding:18px;}

.topRow{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
h1{margin:0;font-size:28px;}
.topActions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.badge{
  padding:8px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  background:rgba(255,255,255,.06);
  color:var(--muted);
  font-size:13px;
  transition:all var(--duration-fast) var(--ease-in-out);
}
.chip{
  border-radius:999px;
  padding:8px 10px;
  font-size:13px;
  transition:all var(--duration-fast) var(--ease-in-out);
}
.chip:hover{
  transform:translateY(-1px);
  box-shadow:var(--shadow);
}

body.light-mode .badge{
  background:rgba(33,150,243,.08);
  border-color:rgba(33,150,243,.2);
  color:var(--primary);
}
body.light-mode .chip{
  background:rgba(33,150,243,.08);
  border-color:rgba(33,150,243,.2);
}

.card{
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  transition:all var(--duration-base) var(--ease-in-out);
}
header .card{margin-top:14px;}
body.light-mode .card{
  background:#FFFFFF;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}

.field{display:grid;gap:6px;}
.field.inline{min-width:220px;}
.switch{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px;user-select:none;}
.switch input{width:18px;height:18px;}
label{color:var(--muted);font-size:13px;}
select,input{
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.24);
  color:var(--text);
  outline:none;
  transition:all var(--duration-fast) var(--ease-in-out);
}
select:focus,input:focus{border-color:rgba(106,166,255,.55);box-shadow:0 0 0 4px rgba(106,166,255,.12);}

body.light-mode select,
body.light-mode input{
  background:#FFFFFF;
  border:1px solid rgba(0,0,0,.15);
  color:var(--text);
}
body.light-mode select:focus,
body.light-mode input:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 4px rgba(33,150,243,.12);
}

.courseRow{display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap;}
.actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.presetRow{display:flex;gap:8px;flex-wrap:wrap;}
.presetBtn{
  padding:8px 12px;
  border-radius:999px;
  font-size:13px;
  transition:all var(--duration-fast) var(--ease-in-out);
}
.presetBtn:hover{
  background:rgba(106,166,255,.2);
  transform:translateY(-1px) scale(1.05);
}
.presetBtn:active{
  transform:translateY(0) scale(0.98);
}

body.light-mode .presetBtn{
  background:rgba(33,150,243,.08);
  border-color:rgba(33,150,243,.2);
}
body.light-mode .presetBtn:hover{
  background:rgba(33,150,243,.15);
}
.field.presets{min-width:auto;}
button{
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.06);
  color:var(--text);
  cursor:pointer;
  transition:all var(--duration-fast) var(--ease-out);
}
button:hover{
  background:rgba(255,255,255,.1);
  transform:translateY(-1px);
}
button:active{
  transform:translateY(0) scale(0.98);
}
button.primary{border-color:rgba(106,166,255,.55);background:rgba(106,166,255,.15);}
button.primary:hover{background:rgba(106,166,255,.22);}
button.danger{border-color:rgba(255,106,122,.5);background:rgba(255,106,122,.12);}
button.danger:hover{background:rgba(255,106,122,.18);}

body.light-mode button{
  background:rgba(0,0,0,.04);
  border-color:rgba(0,0,0,.1);
}
body.light-mode button:hover{
  background:rgba(0,0,0,.08);
}
body.light-mode button.primary{
  border-color:var(--primary);
  background:rgba(33,150,243,.1);
  color:var(--primary);
}
body.light-mode button.primary:hover{
  background:rgba(33,150,243,.15);
}

.statsRow{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px;}
.stat{
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  padding:12px;
  transition:all var(--duration-base) var(--ease-in-out);
}
.stat:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow);
}
.stat .k{color:var(--muted);font-size:12px;}
.stat .v{font-size:22px;font-weight:800;margin-top:4px;}

body.light-mode .stat{
  background:rgba(33,150,243,.05);
  border:1px solid rgba(33,150,243,.15);
}
.muted{color:var(--muted);font-size:12px;margin-top:10px;}

#gameCard{margin-top:14px;}
.gameTop{display:grid;grid-template-columns:1fr 180px;gap:14px;align-items:start;}
@media(max-width:860px){
  .gameTop{grid-template-columns:1fr;}
  .topRow{flex-direction:column;align-items:flex-start;}
  .statsRow{grid-template-columns:repeat(2,1fr);}
  .courseRow{flex-direction:column;align-items:stretch;}
  .field.inline{min-width:100%;}
}
.promptLabel{color:var(--muted);font-size:12px;}
.prompt{
  font-size:30px;
  font-weight:900;
  margin-top:6px;
  letter-spacing:.02em;
  transition:transform var(--duration-base) var(--ease-in-out);
}
.prompt .done{background:rgba(255, 80, 96, .55);color:#fff;border-radius:8px;padding:0 4px;}
.meaning{color:var(--muted);font-size:16px;margin-top:10px;min-height:1.4em;}

body.light-mode .prompt .done{
  background:var(--error-500);
  color:#fff;
}
.hint{color:var(--muted);font-size:18px;margin-top:8px;min-height:1.6em;line-height:1.4;}
.hint.wrong{color:#ffb3bc;}
.hint .done{background:rgba(255, 80, 96, .55);color:#fff;border-radius:6px;padding:0 2px;}
.hint .sep{opacity:.7;}

/* 色覚異常対応: フィードバック表示 */
.feedback{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:8px;
  font-weight:700;
  font-size:14px;
  margin-top:6px;
}
.feedback.success{
  background:var(--success-50);
  color:var(--success-700);
  border:2px solid var(--success);
}
.feedback.error-fb{
  background:var(--error-50);
  color:var(--error-700);
  border:2px solid var(--danger);
}
body.light-mode .feedback.success{
  background:#E8F5E9;
  color:#388E3C;
}
body.light-mode .feedback.error-fb{
  background:#FFEBEE;
  color:#D32F2F;
}
.scoreWrap{display:grid;gap:6px;justify-items:end;}
.scoreWrap .mini{color:var(--muted);font-size:12px;}
.scoreWrap .big{font-size:24px;font-weight:900;}

.inputRow{display:flex;gap:10px;align-items:center;margin-top:14px;flex-wrap:wrap;}
#typeInput{flex:1;min-width:240px;font-size:18px;}

#resultCard{margin-top:14px;}
h2{margin:0 0 12px 0;}
.resultGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;}
@media(max-width:860px){.resultGrid{grid-template-columns:1fr;}}

.stat .change{
  font-size:12px;
  color:var(--muted);
  margin-top:4px;
}
.stat .change.positive{
  color:var(--success);
}
.stat .change.negative{
  color:var(--danger);
}

.keyboard{
  margin-top:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  padding:12px;
  background:rgba(0,0,0,.16);
  transition:all var(--duration-base) var(--ease-in-out);
}
.keyRow{display:flex;gap:8px;justify-content:center;margin-top:8px;}
.keyRow:first-child{margin-top:0;}
.key{
  min-width:34px;
  padding:10px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.05);
  text-align:center;
  font-weight:700;
  transition:all var(--duration-fast) var(--ease-in-out);
}
.key.active{
  border-color:rgba(106,166,255,.75);
  box-shadow:0 0 0 4px rgba(106,166,255,.12);
  background:rgba(106,166,255,.16);
  transform:scale(1.1);
}
.key.wide{min-width:64px;}

body.light-mode .keyboard{
  background:rgba(33,150,243,.05);
  border-color:rgba(33,150,243,.15);
}
body.light-mode .key{
  background:#FFFFFF;
  border-color:rgba(33,150,243,.2);
}
body.light-mode .key.active{
  border-color:var(--primary);
  box-shadow:0 0 0 4px rgba(33,150,243,.15);
  background:rgba(33,150,243,.2);
}

.badgesGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px;}
@media(max-width:520px){.badgesGrid{grid-template-columns:1fr;}}
.badgeCard{
  border:2px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.04);
  border-radius:14px;
  padding:12px;
  transition:all var(--duration-base) var(--ease-in-out);
}
.badgeCard:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow);
}
.badgeCard.locked{opacity:.5;filter:grayscale(1);}
.badgeName{font-weight:800;margin-top:4px;}
.badgeDesc{color:var(--muted);font-size:12px;margin-top:4px;}

/* ダイアログスタイル改善 */
dialog{
  background:var(--card);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px;
  max-width:800px;
  width:90%;
  animation: scaleIn 0.3s var(--ease-out);
}
@keyframes scaleIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
dialog::backdrop{
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(4px);
  animation: fadeIn 0.3s var(--ease-in-out);
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
dialog h3{
  margin:0 0 16px 0;
  font-size:24px;
  text-align:center;
}

body.light-mode dialog{
  background:#FFFFFF;
  border:1px solid rgba(0,0,0,.12);
}
body.light-mode dialog::backdrop{
  background:rgba(0,0,0,0.4);
}
.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:18px;
  background:rgba(0,0,0,.85);
  border:1px solid rgba(255,255,255,.12);
  padding:12px 16px;
  border-radius:14px;
  backdrop-filter: blur(8px);
  max-width:min(92vw,520px);
  display:none;
  font-weight:600;
  box-shadow:var(--shadow);
  transition:all var(--duration-base) var(--ease-in-out);
}
.toast.show{
  display:block;
  animation: fadeInUp 0.3s var(--ease-out);
}

body.light-mode .toast{
  background:rgba(33,150,243,.95);
  color:#fff;
  border-color:var(--primary);
}

/* アニメーション */
@keyframes successPulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
  50% { transform: scale(1.05); box-shadow: 0 0 20px 10px rgba(76, 175, 80, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
}
.prompt.success { animation: successPulse 0.4s var(--ease-out); }

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
  20%, 40%, 60%, 80% { transform: translateX(6px); }
}
.prompt.error { animation: shake 0.4s var(--ease-in-out); }

@keyframes badgeAppear {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  70% { transform: scale(1.2) rotate(10deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}
.badgeCard.new { animation: badgeAppear var(--duration-slower) var(--ease-bounce); }

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.page-enter { animation: fadeInUp var(--duration-slow) var(--ease-out); }

/* アクセシビリティ: アニメーション無効化 */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* フォーカス表示強化 */
*:focus {
  outline: none;
}
*:focus-visible {
  outline: 3px solid var(--primary);
  outline-offset: 2px;
  border-radius: 4px;
}
button:focus-visible {
  outline: 3px solid var(--primary);
  outline-offset: 2px;
  box-shadow: 0 0 0 6px rgba(33, 150, 243, 0.2);
}
input:focus-visible, select:focus-visible {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.15);
  outline: none;
}
